jQuery(document).ready(function(a){DEDO_Admin_Download={options:{},init:function(a){this.options=a,this.eventListeners(),this.updateStatus()},eventListeners:function(){var b=this;a(".dedo-delete-file").on("click",function(a){b.deleteFile(),a.preventDefault()}),a(document).on("change",'[name="members_only"]',function(b){1==a(this).val()||""==a(this).val()?a("#members_only_sub").show():a("#members_only_sub").hide()})},addFile:function(b){a("#dedo-file-url").val(b),a(".file-icon img").attr("src",this.options.default_icon),a(".file-name").html("--"),a(".file-size").html("--"),this.updateStatus(),this.toggleViews()},deleteFile:function(){a("#dedo-file-url").val(""),this.updateStatus(),this.toggleViews()},toggleViews:function(){""!=a("#dedo-file-url").val()?a("#dedo-new-download").hide(0,function(){a("#dedo-existing-download").show()}):a("#dedo-existing-download").hide(0,function(){a("#dedo-new-download").show()})},updateStatus:function(){var b=this,c=a("#dedo-file-url").val();a(".file-status .status").removeClass("local remote warning").addClass("spinner"),a.ajax({url:b.options.ajaxURL,data:{action:b.options.action,nonce:b.options.nonce,url:c},dataType:"json",success:function(c){a(".file-name").html(c.content.filename),"success"==c.status?(a(".file-icon img").attr("src",c.content.icon),a(".file-size").html(c.content.size),a(".file-status .status").removeClass("spinner").addClass(c.content.type),"local"==c.content.type&&a(".file-status .status").attr("title",b.options.lang_local),"remote"==c.content.type&&a(".file-status .status").attr("title",b.options.lang_remote)):a(".file-status .status").removeClass("spinner").addClass("warning").attr("title",b.options.lang_warning)}})}},DEDO_Upload_Modal={$container:a("#dedo-upload-modal #dedo-drag-drop-area"),$progressPercent:a("#dedo-progress-percent"),$progressText:a("#dedo-progress-text"),$progressError:a("#dedo-progress-error"),uploader:{},init:function(a){this.options=a,this.uploader=new plupload.Uploader(this.options),this.uploader.init(),this.uploadListeners()},uploadListeners:function(){var b=this;this.uploader.bind("FilesAdded",function(a,c){b.$container.addClass("uploading"),b.$progressError.hide(),a.refresh(),a.start()}),this.uploader.bind("UploadProgress",function(a,c){b.$progressPercent.css("width",c.percent+"%"),b.$progressText.html(c.percent+"%")}),this.uploader.bind("FileUploaded",function(c,d,e){var e=a.parseJSON(e.response);e.error&&e.error.code?b.uploader.trigger("Error",{code:e.error.code,message:e.error.message,file:d}):(DEDO_Admin_Download.addFile(e.file.url),setTimeout(function(){a("body").trigger("closeModal"),setTimeout(function(){b.$container.removeClass("uploading")},300)},1e3))}),this.uploader.bind("Error",function(a,c){b.$progressError.html("<p>"+c.message+"</p>").show(),b.$container.removeClass("uploading"),a.refresh()})}},DEDO_Existing_Modal={$file_url:a("#dedo-file-url"),$confirm:a("#dedo-select-done"),options:{},init:function(a){this.options=a,this.fileBrowser(),this.confirm(),this.focus()},fileBrowser:function(){var b=this;a("#dedo-file-browser").fileTree(this.options,function(a){var c=a.replace(b.options.root,b.options.url);b.$file_url.val(c)})},confirm:function(){var b=this;b.$confirm.on("click",function(c){var d=b.$file_url.val();DEDO_Admin_Download.addFile(d),a("body").trigger("closeModal"),c.preventDefault()})},focus:function(){var b=this;a("body").on("click",".dedo-modal-action.select-existing",function(){b.$file_url.focus()})}},DEDO_Admin_Download.init(updateStatusArgs),DEDO_Upload_Modal.init(pluploadArgs),DEDO_Existing_Modal.init(fileBrowserArgs)});